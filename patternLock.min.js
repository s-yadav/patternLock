!function(t,e,n,r){"use strict";function a(t){for(var e=t.holder,n=t.option,r=n.matrix,a=n.margin,i=n.radius,o=['<ul class="patt-wrap" style="padding:'+a+'px">'],s=0,l=r[0]*r[1];l>s;s++)o.push('<li class="patt-circ" style="margin:'+a+"px; width : "+2*i+"px; height : "+2*i+"px; -webkit-border-radius: "+i+"px; -moz-border-radius: "+i+"px; border-radius: "+i+'px; "><div class="patt-dots"></div></li>');o.push("</ul>"),e.html(o.join("")).css({width:r[1]*(2*i+2*a)+2*a+"px",height:r[0]*(2*i+2*a)+2*a+"px"}),t.pattCircle=t.holder.find(".patt-circ")}function i(t,e,n,r){var a=e-t,i=r-n;return{length:Math.ceil(Math.sqrt(a*a+i*i)),angle:Math.round(180*Math.atan2(i,a)/Math.PI)}}function o(){}function s(e,n){var r=this,i=r.token=Math.random(),h=p[i]=new o,u=h.holder=t(e);if(0!=u.length){h.object=r,n=h.option=t.extend({},s.defaults,n),a(h),u.addClass("patt-holder"),"static"==u.css("position")&&u.css("position","relative"),u.on("touchstart mousedown",function(t){d.call(this,t,r)}),h.option.onDraw=n.onDraw||l;var c=n.mapper;"object"==typeof c?h.mapperFunc=function(t){return c[t]}:"function"==typeof c?h.mapperFunc=c:h.mapperFunc=l,h.option.mapper=null}}var l=function(){},p={},d=function(e,r){e.preventDefault();var a=p[r.token];if(!a.disabled){a.option.patternVisible||a.holder.addClass("patt-hidden");var i="touchstart"==e.type?"touchmove":"mousemove",o="touchstart"==e.type?"touchend":"mouseup";t(this).on(i+".pattern-move",function(t){h.call(this,t,r)}),t(n).one(o,function(){u.call(this,e,r)});var s=a.holder.find(".patt-wrap"),l=s.offset();a.wrapTop=l.top,a.wrapLeft=l.left,r.reset()}},h=function(e,n){e.preventDefault();var r=e.pageX||(e.originalEvent||e).touches[0].pageX,a=e.pageY||(e.originalEvent||e).touches[0].pageY,o=p[n.token],s=o.pattCircle,l=o.patternAry,d=o.option.lineOnMove,h=o.getIdxFromPoint(r,a),u=h.idx,c=o.mapperFunc(u)||u;if(l.length>0){var f=i(o.lineX1,h.x,o.lineY1,h.y);o.line.css({width:f.length+10+"px",transform:"rotate("+f.angle+"deg)","-webkit-transform":"rotate("+f.angle+"deg)"})}if(u){if(-1==l.indexOf(c)){var v,m=t(s[u-1]);if(o.lastPosObj){for(var g=o.lastPosObj,w=g.i,x=g.j,b=Math.abs(h.i-w),j=Math.abs(h.j-x);(0==b&&j>1||0==j&&b>1||j==b&&j>1)&&(x!=h.j||w!=h.i);){w=b?Math.min(h.i,w)+1:w,x=j?Math.min(h.j,x)+1:x,b=Math.abs(h.i-w),j=Math.abs(h.j-x);var k=(x-1)*o.option.matrix[1]+w,M=o.mapperFunc(k)||k;-1==l.indexOf(M)&&(t(s[k-1]).addClass("hovered"),l.push(M))}v=[],h.j-g.j>0?v.push("s"):h.j-g.j<0?v.push("n"):0,h.i-g.i>0?v.push("e"):h.i-g.i<0?v.push("w"):0,v=v.join("-")}m.addClass("hovered"),l.push(c);var y=o.option.margin,P=o.option.radius,C=(h.i-1)*(2*y+2*P)+2*y+P,F=(h.j-1)*(2*y+2*P)+2*y+P;if(1!=l.length){var O=i(o.lineX1,C,o.lineY1,F);o.line.css({width:O.length+10+"px",transform:"rotate("+O.angle+"deg)","-webkit-transform":"rotate("+O.angle+"deg)"}),d||o.line.show()}v&&(o.lastElm.addClass(v+" dir"),o.line.addClass(v+" dir"));var D=t('<div class="patt-lines" style="top:'+(F-5)+"px; left:"+(C-5)+'px"></div>');o.line=D,o.lineX1=C,o.lineY1=F,o.holder.append(D),d||o.line.hide(),o.lastElm=m}o.lastPosObj=h}},u=function(t,e){t.preventDefault();var n=p[e.token],r=n.patternAry.join(n.option.delimiter);n.holder.off(".pattern-move").removeClass("patt-hidden"),r&&(n.option.onDraw(r),n.line.remove(),n.rightPattern&&(r==n.rightPattern?n.onSuccess():(n.onError(),e.error())))};o.prototype={constructor:o,getIdxFromPoint:function(t,e){var n=this.option,r=n.matrix,a=t-this.wrapLeft,i=e-this.wrapTop,o=null,s=n.margin,l=2*n.radius+2*s,p=Math.ceil(a/l),d=Math.ceil(i/l),h=a%l,u=i%l;return p<=r[1]&&d<=r[0]&&h>2*s&&u>2*s&&(o=(d-1)*r[1]+p),{idx:o,i:p,j:d,x:a,y:i}}},s.prototype={constructor:s,option:function(t,e){var n=p[this.token],i=n.option;return e===r?i[t]:(i[t]=e,void(("margin"==t||"matrix"==t||"radius"==t)&&a(n)))},getPattern:function(){var t=p[this.token];return(t.patternAry||[]).join(t.option.delimiter)},setPattern:function(t){var e=p[this.token],n=e.option,r=n.matrix,a=n.margin,i=n.radius;if(n.enableSetPattern){this.reset(),e.wrapLeft=0,e.wrapTop=0;for(var o=0;o<t.length;o++){var s=t[o]-1,d=s%r[1],u=Math.floor(s/r[1]),c=d*(2*a+2*i)+2*a+i,f=u*(2*a+2*i)+2*a+i;h.call(null,{pageX:c,pageY:f,preventDefault:l,originalEvent:{touches:[{pageX:c,pageY:f}]}},this)}}},enable:function(){var t=p[this.token];t.disabled=!1},disable:function(){var t=p[this.token];t.disabled=!0},reset:function(){var t=p[this.token];t.pattCircle.removeClass("hovered dir s n w e s-w s-e n-w n-e"),t.holder.find(".patt-lines").remove(),t.patternAry=[],t.lastPosObj=null,t.holder.removeClass("patt-error")},error:function(){p[this.token].holder.addClass("patt-error")},checkForPattern:function(t,e,n){var r=p[this.token];r.rightPattern=t,r.onSuccess=e||l,r.onError=n||l}},s.defaults={matrix:[3,3],margin:20,radius:25,patternVisible:!0,lineOnMove:!0,delimiter:"",enableSetPattern:!1},e.PatternLock=s}(window.jQuery||window.Zepto,window,document);